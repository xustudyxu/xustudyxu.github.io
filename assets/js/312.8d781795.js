(window.webpackJsonp=window.webpackJsonp||[]).push([[312],{663:function(t,s,a){"use strict";a.r(s);var e=a(10),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"nginx-站点与认证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-站点与认证"}},[t._v("#")]),t._v(" Nginx 站点与认证")]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#nginx制作下载站点"}},[t._v("Nginx制作下载站点")]),s("ul",[s("li",[s("a",{attrs:{href:"#autoindex"}},[t._v("autoindex")])]),s("li",[s("a",{attrs:{href:"#autoindex-exact-size"}},[t._v("autoindexexactsize")])]),s("li",[s("a",{attrs:{href:"#autoindex-format"}},[t._v("autoindex_format")])]),s("li",[s("a",{attrs:{href:"#autoindex-localtime"}},[t._v("autoindex_localtime")])]),s("li",[s("a",{attrs:{href:"#实现案例"}},[t._v("实现案例")])])])]),s("li",[s("a",{attrs:{href:"#nginx用户认证模块"}},[t._v("Nginx用户认证模块")]),s("ul",[s("li",[s("a",{attrs:{href:"#auth-basic"}},[t._v("auth_basic")])]),s("li",[s("a",{attrs:{href:"#auth-basic-user-file"}},[t._v("authbasicuser_file")])]),s("li",[s("a",{attrs:{href:"#实现案例"}},[t._v("实现案例")])])])])])]),s("p"),t._v(" "),s("h2",{attrs:{id:"nginx制作下载站点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx制作下载站点"}},[t._v("#")]),t._v(" Nginx制作下载站点")]),t._v(" "),s("p",[t._v("首先我们先要清楚什么是下载站点？")]),t._v(" "),s("p",[t._v("我们先来看一个网站 "),s("a",{attrs:{href:"http://nginx.org/download/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://nginx.org/download/"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("这个是大家去下载 Nginx 时经常访问的网站，该网站主要就是用来提供用户来下载相关资源的网站，就叫做下载网站。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting1@master/20220806/image.17v6jxd79kao.webp",alt:"image"}})]),t._v(" "),s("p",[t._v("如何制作一个下载站点：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Nginx 使用的是模块 "),s("code",[t._v("ngx_http_autoindex_module")]),t._v(" 来实现的（自带），该模块处理以斜杠(『 / 』)结尾的请求，并生成目录列表。")])]),t._v(" "),s("li",[s("p",[t._v("Nginx 编译的时候会自动加载该模块，但是该模块默认是关闭的，我们需要使用下来指令来完成对应的配置")])])]),t._v(" "),s("h3",{attrs:{id:"autoindex"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#autoindex"}},[t._v("#")]),t._v(" autoindex")]),t._v(" "),s("p",[s("code",[t._v("autoindex")]),t._v(" 指令启用或禁用目录列表的输出")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("语法")]),t._v(" "),s("th",[t._v("默认值")]),t._v(" "),s("th",[t._v("位置")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("autoindex <on | off>;")]),t._v(" "),s("td",[t._v("autoindex off;")]),t._v(" "),s("td",[t._v("http、server、location")])])])]),t._v(" "),s("h3",{attrs:{id:"autoindex-exact-size"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#autoindex-exact-size"}},[t._v("#")]),t._v(" autoindex_exact_size")]),t._v(" "),s("p",[s("code",[t._v("autoindex_exact_size")]),t._v(" 指令对应 HTLM 格式，指定是否在目录列表展示文件的详细大小。")]),t._v(" "),s("p",[t._v("默认为 on，显示出文件的确切大小，单位是 bytes。")]),t._v(" "),s("p",[t._v("改为 off 后，显示出文件的大概大小，单位是 kB 或者 MB 或者 GB。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("语法")]),t._v(" "),s("th",[t._v("默认值")]),t._v(" "),s("th",[t._v("位置")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("autoindex_exact_size <on | off>;")]),t._v(" "),s("td",[t._v("autoindex_exact_size on;")]),t._v(" "),s("td",[t._v("http、server、location")])])])]),t._v(" "),s("h3",{attrs:{id:"autoindex-format"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#autoindex-format"}},[t._v("#")]),t._v(" autoindex_format")]),t._v(" "),s("p",[s("code",[t._v("autoindex_format")]),t._v(" 指令设置目录列表的格式。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("语法")]),t._v(" "),s("th",[t._v("默认值")]),t._v(" "),s("th",[t._v("位置")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("autoindex_format <html | xml | json | jsonp>;")]),t._v(" "),s("td",[t._v("autoindex_format html;")]),t._v(" "),s("td",[t._v("http、server、location")])])])]),t._v(" "),s("p",[t._v("只有当 "),s("code",[t._v("autoindex_format")]),t._v(" 指令设置为 html 时候，上方的 "),s("code",[t._v("autoindex_exact_size")]),t._v(" 指令才会起作用。")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("该指令在 1.7.9 及以后版本中出现。")])]),t._v(" "),s("h3",{attrs:{id:"autoindex-localtime"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#autoindex-localtime"}},[t._v("#")]),t._v(" autoindex_localtime")]),t._v(" "),s("p",[s("code",[t._v("autoindex_localtime")]),t._v(" 指令对应 HTML 格式，是否在目录列表上显示时间。")]),t._v(" "),s("p",[t._v("默认为 off，显示的文件时间为 GMT 时间。")]),t._v(" "),s("p",[t._v("改为 on 后，显示的文件时间为文件的服务器时间。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("语法")]),t._v(" "),s("th",[t._v("默认值")]),t._v(" "),s("th",[t._v("位置")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("autoindex_localtime <on |off>;")]),t._v(" "),s("td",[t._v("autoindex_localtime off;")]),t._v(" "),s("td",[t._v("http、server、location")])])])]),t._v(" "),s("h3",{attrs:{id:"实现案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现案例"}},[t._v("#")]),t._v(" 实现案例")]),t._v(" "),s("p",[t._v("自行准备几个文件或者压缩包，我这里准备了 4 个用过的压缩包。")]),t._v(" "),s("ul",[s("li",[t._v("创建一个目录，将压缩包放入其中，我这里创建的路径是 "),s("code",[t._v("/opt/download")])])]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /opt/download\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("然后把压缩包都放到该目录下")])]),t._v(" "),s("p",[t._v("效果如下:")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master download"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pwd")]),t._v("\n/opt/download\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master download"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n总用量 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("545504")]),t._v("\n-rw-r--r--. "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("408587111")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":02 hadoop-2.10.1.tar.gz\n-rw-r--r--. "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("145520298")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":29 jdk-8u301-linux-x64.tar.gz\n-rw-r--r--  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25680")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2017")]),t._v(" mysql57-community-release-el7-11.noarch.rpm\n-rw-r--r--  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4456335")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("月   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":40 mysql-connector-java-5.1.48.tar.gz\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("ul",[s("li",[t._v("打开 Nginx 的配置文件")])]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /usr/local/nginx/conf/nginx.conf\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("添加配置如下内容：")])]),t._v(" "),s("p",[t._v(':::: tabs cache-lifetime="5" :options="{ useUrlFragment: false }"')]),t._v(" "),s("p",[t._v("::: tab 有注释版")]),t._v(" "),s("div",{staticClass:"language-nginx line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /download")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /opt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载目录所在的路径，location 后面的 /download 拼接到 /opt 后面")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以这些后缀的文件点击后为下载，注释掉则 txt 等文件是在网页打开并查看内容")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ("),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_filename")]),t._v(" ~* ^.*?\\.(txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx|conf)$)")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t  "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Content-Disposition "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'attachment;'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t\t\t  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用目录列表的输出")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_exact_size")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在目录列表展示文件的详细大小")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_format")]),t._v(" html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置目录列表的格式为 html")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_localtime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 目录列表上显示系统时间")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("p",[t._v(":::")]),t._v(" "),s("p",[t._v("::: tab 无注释版")]),t._v(" "),s("div",{staticClass:"language-nginx line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /download")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /opt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ("),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_filename")]),t._v(" ~* ^.*?\\.(txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx|conf)$)")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t  "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Content-Disposition "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'attachment;'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_exact_size")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_format")]),t._v(" html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_localtime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("p",[t._v(":::")]),t._v(" "),s("p",[t._v("::::")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("root 指令后面必须是下载路径，因为我的下载路径是 "),s("code",[t._v("/opt/download")]),t._v("，所以这里填写 "),s("code",[t._v("/opt")]),t._v("，而 location 的 "),s("code",[t._v("/download")]),t._v(" 会自动拼接到后面，形成完整的下载路径。")])]),t._v(" "),s("ul",[s("li",[t._v("访问 "),s("code",[t._v("192.168.91.200/download")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting1@master/20220806/image.3gmq4emy84w0.webp",alt:"image"}})]),t._v(" "),s("ul",[s("li",[t._v("JSON和XML格式(一般不用这两种格式)")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting1@master/20220806/image.6n5evv8oo5k0.webp",alt:"image"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting1@master/20220806/image.kvsekaaiu40.webp",alt:"image"}})]),t._v(" "),s("h2",{attrs:{id:"nginx用户认证模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx用户认证模块"}},[t._v("#")]),t._v(" Nginx用户认证模块")]),t._v(" "),s("p",[t._v("对应系统资源的访问，我们往往需要限制谁能访问，谁不能访问。这块就是我们通常所说的认证部分，认证需要做的就是根据用户输入的用户名和密码来判定用户是否为合法用户，如果是则放行访问，如果不是则拒绝访问。")]),t._v(" "),s("p",[t._v("Nginx 对应用户认证这块是通过 "),s("code",[t._v("ngx_http_auth_basic_module")]),t._v(" 模块来实现的，它允许通过使用「HTTP基本身份验证」协议验证用户名和密码来限制对资源的访问。默认情况下 Nginx 是已经安装了该模块，如果不需要则使用 "),s("code",[t._v("--without-http_auth_basic_module")]),t._v(" 删除认证模块。")]),t._v(" "),s("p",[t._v("该模块的指令比较简单。")]),t._v(" "),s("h3",{attrs:{id:"auth-basic"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#auth-basic"}},[t._v("#")]),t._v(" auth_basic")]),t._v(" "),s("p",[s("code",[t._v("auth_basic")]),t._v(" 指令使用「HTTP基本身份验证」协议启用用户名和密码的验证。默认关闭。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("语法")]),t._v(" "),s("th",[t._v("默认值")]),t._v(" "),s("th",[t._v("位置")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("auth_basic <string | off>;")]),t._v(" "),s("td",[t._v("auth_basic off;")]),t._v(" "),s("td",[t._v("http、server、location、limit_except")])])])]),t._v(" "),s("p",[t._v("开启后，服务端会返回 401，指定的字符串会返回到客户端，给用户以提示信息，但是不同的浏览器对内容的展示不一致。")]),t._v(" "),s("h3",{attrs:{id:"auth-basic-user-file"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#auth-basic-user-file"}},[t._v("#")]),t._v(" auth_basic_user_file")]),t._v(" "),s("p",[s("code",[t._v("auth_basic_user_file")]),t._v(" 指令指定用户名和密码所在文件，包括所在的路径。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("语法")]),t._v(" "),s("th",[t._v("默认值")]),t._v(" "),s("th",[t._v("位置")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("auth_basic_user_file "),s("file",[t._v(";")])],1),t._v(" "),s("td",[t._v("—")]),t._v(" "),s("td",[t._v("http、server、location、limit_except")])])])]),t._v(" "),s("p",[t._v("指定文件路径，该文件中设置用户名和密码，密码需要进行加密。可以采用工具自动生成。")]),t._v(" "),s("h3",{attrs:{id:"实现案例-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现案例-2"}},[t._v("#")]),t._v(" 实现案例")]),t._v(" "),s("ul",[s("li",[t._v("在配置文件 nginx.conf 添加如下内容：")])]),t._v(" "),s("p",[t._v(':::: tabs cache-lifetime="5" :options="{ useUrlFragment: false }"')]),t._v(" "),s("p",[t._v("::: tab 有注释版")]),t._v(" "),s("div",{staticClass:"language-nginx line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /download")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载站点知识")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /opt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载目录所在的路径，location 后面的 /download 拼接到 /opt 后面")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t\t\t  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用目录列表的输出")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_exact_size")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在目录列表展示文件的详细大小")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_format")]),t._v(" html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置目录列表的格式为 html")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_localtime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 目录列表上显示系统时间")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 认证模块知识")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auth_basic")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'please input your auth'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用户名和密码的验证，并在请求头插入数据")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auth_basic_user_file")]),t._v(" htpasswd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 存用户名和密码的文件路径")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("p",[t._v(":::")]),t._v(" "),s("p",[t._v("::: tab 无注释版")]),t._v(" "),s("div",{staticClass:"language-nginx line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /download")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /opt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_exact_size")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_format")]),t._v(" html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex_localtime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    \n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auth_basic")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'please input your auth'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auth_basic_user_file")]),t._v(" htpasswd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("p",[t._v(":::")]),t._v(" "),s("p",[t._v("::::")]),t._v(" "),s("ul",[s("li",[t._v("我们需要使用 "),s("code",[t._v("htpasswd")]),t._v(" 工具生成包含用户名和密码的文件")])]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" httpd-tools\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("该工具基本操作指令如下：")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("htpasswd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" /usr/local/nginx/conf/htpasswd username   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建一个新文件记录用户名和密码，密码后面弹出输入")]),t._v("\nhtpasswd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-b")]),t._v(" /usr/local/nginx/conf/htpasswd username password   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在指定文件新增一个用户名和密码")]),t._v("\nhtpasswd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v(" /usr/local/nginx/conf/htpasswd username   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从指定文件删除一个用户信息")]),t._v("\nhtpasswd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /usr/local/nginx/conf/htpasswd username   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证用户名和密码是否正确")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("根据需求指定生成路径的位置。")]),t._v(" "),s("ul",[s("li",[t._v("我们创建一个 frx 的用户名，密码是 123456")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting1@master/20220806/image.5uqgyc41uuc0.webp",alt:"image"}})]),t._v(" "),s("p",[t._v("可以查看生成的文件内容")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /usr/local/nginx/conf/htpasswd")]),t._v("\nfrx:"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$apr1")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$wDXdSh0O")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$yR66Agylnta9zupO7cD3k")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("ul",[s("li",[t._v("浏览器访问 "),s("code",[t._v("192.168.91.200/download")]),s("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting1@master/20220806/image.1j6bwl4jr2g0.webp",alt:"image"}})])]),t._v(" "),s("p",[t._v("上述方式虽然能实现用户名和密码的验证，但是大家也看到了，所有的用户名和密码信息都记录在文件里面，如果用户量过大的话，这种方式就显得有点麻烦了，这时候我们就得通过后台业务代码来进行用户权限的校验了。")])])}),[],!1,null,null,null);s.default=n.exports}}]);