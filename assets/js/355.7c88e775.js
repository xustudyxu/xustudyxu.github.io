(window.webpackJsonp=window.webpackJsonp||[]).push([[355],{704:function(t,v,_){"use strict";_.r(v);var s=_(10),r=Object(s.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"linux-日志管理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#linux-日志管理"}},[t._v("#")]),t._v(" Linux 日志管理")]),t._v(" "),v("h2",{attrs:{id:"基本介绍"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#基本介绍"}},[t._v("#")]),t._v(" 基本介绍")]),t._v(" "),v("ol",[v("li",[t._v("日志文件是重要的系统信息文件，其中记录了许多重要的系统事件，包括用户的登录信息、系统的启动信息、系统的安全信息、邮件相关信息、各种服务相关信息等。")]),t._v(" "),v("li",[t._v("日志对于安全来说也很重要，它记录了系统每天发生的各种事情，通过日志来检查错误发生的原因，或者受到攻击时攻击者留下的痕迹。")]),t._v(" "),v("li",[t._v("可以这样理解"),v("strong",[t._v("日志是用来记录重大事件的工具")])])]),t._v(" "),v("h2",{attrs:{id:"系统常用的日志"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#系统常用的日志"}},[t._v("#")]),t._v(" 系统常用的日志")]),t._v(" "),v("ul",[v("li",[t._v("/var/log/目录就是系统日志文件的保存位置，看张图")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting@master/studynotes/Linux/images/18/01.png",alt:"01"}})]),t._v(" "),v("ul",[v("li",[t._v("系统常用的日志")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting@master/studynotes/Linux/images/18/02.png",alt:"02"}})]),t._v(" "),v("ul",[v("li",[t._v("应用案例")])]),t._v(" "),v("blockquote",[v("p",[t._v("使用root用户通过xshell7登陆，第一次使用错误的密码，第二次使用正确的密码登录成功看看在日志文件/var/log/secure里有没有记录相关信息")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting@master/studynotes/Linux/images/18/03.png",alt:"03"}})]),t._v(" "),v("h2",{attrs:{id:"日志管理服务-rsyslogd"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#日志管理服务-rsyslogd"}},[t._v("#")]),t._v(" 日志管理服务 rsyslogd")]),t._v(" "),v("p",[t._v("CentOS7.6日志服务是rsyslogd ,CentOS6.x日志服务是syslogd 。rsyslogd功能更强大。rsyslogd的使用、日志文件的格式，和 syslogd 服务兼容的。原理示意图")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting@master/studynotes/Linux/images/18/12.png",alt:"05"}})]),t._v(" "),v("ul",[v("li",[v("p",[t._v("查询Linux中的rsysloged服务是否启动")]),t._v(" "),v("p",[v("font",{attrs:{color:"#DC4040",size:"4",face:"黑体"}},[t._v('ps aux | grep "rsyslog" / grep -v "grep"')])],1)]),t._v(" "),v("li",[v("p",[t._v("查询rsyslogd服务的自启动状态")]),t._v(" "),v("p",[v("font",{attrs:{color:"#DC4040",size:"4",face:"黑体"}},[t._v("systemctl list-unit-files |grep rsyslog")])],1)]),t._v(" "),v("li",[v("p",[t._v("配置文件:/etc/rsyslog.conf")]),t._v(" "),v("p",[t._v("编辑文件时的格式为* . *:存放日志文件其中第一个*代表日志类型，第二个*代表日志级别")])])]),t._v(" "),v("ol",[v("li",[v("p",[t._v("日志类型分为")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("说明")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("auth")]),t._v(" "),v("td",[t._v("pam产生的日志")])]),t._v(" "),v("tr",[v("td",[t._v("authpriv")]),t._v(" "),v("td",[t._v("ssh、ftp等登录信息的验证信息")])]),t._v(" "),v("tr",[v("td",[t._v("corn")]),t._v(" "),v("td",[t._v("时间任务相关")])]),t._v(" "),v("tr",[v("td",[t._v("kern")]),t._v(" "),v("td",[t._v("内核")])]),t._v(" "),v("tr",[v("td",[t._v("lpr")]),t._v(" "),v("td",[t._v("打印")])]),t._v(" "),v("tr",[v("td",[t._v("mail")]),t._v(" "),v("td",[t._v("邮件")])]),t._v(" "),v("tr",[v("td",[t._v("mark(syslog)-rsyslog")]),t._v(" "),v("td",[t._v("服务内部的信息，时间标识")])]),t._v(" "),v("tr",[v("td",[t._v("news")]),t._v(" "),v("td",[t._v("新闻组")])]),t._v(" "),v("tr",[v("td",[t._v("user")]),t._v(" "),v("td",[t._v("用户程序产生的相关信息")])]),t._v(" "),v("tr",[v("td",[t._v("uucp")]),t._v(" "),v("td",[t._v("unix to nuix copy主机之间相关的通信")])]),t._v(" "),v("tr",[v("td",[t._v("local 1-7")]),t._v(" "),v("td",[t._v("自定义的日志设备")])])])])]),t._v(" "),v("li",[v("p",[t._v("日志级别分为")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("级别")]),t._v(" "),v("th",[t._v("说明")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("debug")]),t._v(" "),v("td",[t._v("有调试信息的，日志通信最多")])]),t._v(" "),v("tr",[v("td",[t._v("info")]),t._v(" "),v("td",[t._v("一般信息日志，最常用")])]),t._v(" "),v("tr",[v("td",[t._v("notice")]),t._v(" "),v("td",[t._v("最具有重要性的普通条件的信息")])]),t._v(" "),v("tr",[v("td",[t._v("warning")]),t._v(" "),v("td",[t._v("警告级别")])]),t._v(" "),v("tr",[v("td",[t._v("err")]),t._v(" "),v("td",[t._v("错误级别，阻止某个功能或者模块不能正常工作的信息")])]),t._v(" "),v("tr",[v("td",[t._v("crit")]),t._v(" "),v("td",[t._v("严重级别，阻止整个系统或者整个软件不能正常工作的信息")])]),t._v(" "),v("tr",[v("td",[t._v("alert")]),t._v(" "),v("td",[t._v("需要立刻修改的信息")])]),t._v(" "),v("tr",[v("td",[t._v("emerg")]),t._v(" "),v("td",[t._v("内核崩溃等重要信息")])]),t._v(" "),v("tr",[v("td",[t._v("none")]),t._v(" "),v("td",[t._v("什么都不记录")])])])]),t._v(" "),v("p",[t._v("注意:"),v("strong",[t._v("从上到下，级别从低到高，记录信息越来越少")])])])]),t._v(" "),v("ul",[v("li",[t._v("由日志服务rsyslogd记录的日志文件，日志文件的格式包含以下4列:")])]),t._v(" "),v("ol",[v("li",[t._v("事件产生的时间")]),t._v(" "),v("li",[t._v("产生事件的服务器的主机名")]),t._v(" "),v("li",[t._v("产生事件的服务名或程序名")]),t._v(" "),v("li",[t._v("事件的具体信息")])]),t._v(" "),v("ul",[v("li",[v("p",[t._v("日志如何查看实例")]),t._v(" "),v("p",[t._v("查看一下/var/log/secure日志，这个日志中记录的是用户验证和授权方面的信息来分析如何查看")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting@master/studynotes/Linux/images/18/05.png",alt:"05"}})])]),t._v(" "),v("li",[v("p",[t._v("日志管理服务应用实例")])])]),t._v(" "),v("p",[t._v("在/etc/rsyslog.conf 中添加一个日志文件/var/log/frx.log,当有事件发送时(比如sshd服务相关事件)，该文件会接收到信息并保存.给小伙伴演示重启，登录的情况，看看是否有日志保存")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting@master/studynotes/Linux/images/18/06.png",alt:"05"}})]),t._v(" "),v("h2",{attrs:{id:"日志轮替"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#日志轮替"}},[t._v("#")]),t._v(" 日志轮替")]),t._v(" "),v("h3",{attrs:{id:"基本介绍-2"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#基本介绍-2"}},[t._v("#")]),t._v(" 基本介绍")]),t._v(" "),v("p",[t._v("日志轮替就是把旧的日志文件移动并改名，同时建立新的空日志文件，当旧日志文件超出保存的范围之后，就会进行删除")]),t._v(" "),v("h3",{attrs:{id:"日志轮替文件命名"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#日志轮替文件命名"}},[t._v("#")]),t._v(" 日志轮替文件命名")]),t._v(" "),v("ol",[v("li",[t._v('centos7使用logrotate进行日志轮替管理，要想改变日志轮替文件名字，通过/etc/logrotate.conf配置文件中"dateext"参数:')]),t._v(" "),v("li",[t._v("如果配置文件中有“dateext”参数，那么日志会用日期来作为日志文件的后缀，例如“secure-20201010”。这样日志文件名不会重叠，也就不需要日志文件的改名，只需要指定保存日志个数，删除多余的日志文件即可。")]),t._v(" "),v("li",[t._v('如果配置文件中没有“dateext”参数，日志文件就需要进行改名了。当第一次进行日志轮替时，当前的“secure”日志会自动改名为“secure.1”，然后新建“secure”日志，用来保存新的日志。当第二次进行日志轮替时，“secure.1"会自动改名为“secure.2”，当前的“secure”日志会自动改名为“secure.1”，然后也会新建“secure”日志，用来保存新的日志，以此类推。')])]),t._v(" "),v("h3",{attrs:{id:"logrotate-配置文件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#logrotate-配置文件"}},[t._v("#")]),t._v(" logrotate 配置文件")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("​     "),v("strong",[t._v("/etc/logrotate.conf")]),t._v("为logrotate的全局配置文件")]),t._v(" "),v("p",[t._v("#rotate log files weekly，"),v("strong",[t._v("每周对日志文件进行一次轮替")])]),t._v(" "),v("p",[t._v("weekly")]),t._v(" "),v("p",[t._v("#keep 4 weeks worth of backlogs，"),v("strong",[t._v("共保存4份日志文件，当建立新的日志文件时，旧的将会被删除")])]),t._v(" "),v("p",[t._v("rotate 4")]),t._v(" "),v("p",[t._v("#create new(empty) log files after rotating old ones，"),v("strong",[t._v("创建新的空的日志文件，在日志轮替后")])]),t._v(" "),v("p",[t._v("create")]),t._v(" "),v("p",[t._v("#use date as a suffix of the rotated file,"),v("strong",[t._v("使用日期作为日志轮替文件的后缀")])]),t._v(" "),v("p",[t._v("dateext")]),t._v(" "),v("p",[t._v("uncomment this if you want your log fles compressed,"),v("strong",[t._v("日志文件是否压缩。如果取消注释，则日志会在转储的同时进行压缩")])]),t._v(" "),v("p",[t._v("#compress")]),t._v(" "),v("p",[t._v("#RPM packages drop log rotation information into this directory")]),t._v(" "),v("p",[t._v("include /etc/logrotate.d")]),t._v(" "),v("p",[v("strong",[t._v("#包含/etc/logrotate.d/目录中所有的子配置文件。也就是说会把这个目录中所有子配置文件读取进来，")])]),t._v(" "),v("p",[t._v("#下面是单独设置，优先级更高。")]),t._v(" "),v("p",[t._v("#no packages own wtmp and btmp -- we'll rotate them here")]),t._v(" "),v("p",[t._v("/var/log/wtmp {\nmonthly                 "),v("strong",[t._v("#每月对日志文件进行一次轮替")])]),t._v(" "),v("p",[t._v("​\t\tcreate 0664 root utmp          "),v("strong",[t._v("#建立的新日志文件，权限是0664，所有者是 root ，所属组是utmp 组")])]),t._v(" "),v("p",[t._v("​\t\tminsize 1M            "),v("strong",[t._v("#日志文件最小轮替大小是1MB。也就是日志一定要超过1MB才会轮替，否则就算时间达到一个月，也不进行日志转储")])]),t._v(" "),v("p",[t._v("​\t\trotate 1                 "),v("strong",[t._v("# 仅保留一个日志备份。也就是只有wtmp和wtmp.1日志保留而已")])]),t._v(" "),v("p",[t._v("}")]),t._v(" "),v("p",[t._v("/var/log/btmp {\nmissingok "),v("strong",[t._v("#如果日志不存在，则忽略该日志的警告信息")])]),t._v(" "),v("p",[t._v("​\t\tmonthly")]),t._v(" "),v("p",[t._v("​\t\tcreate 0600 root utmp")]),t._v(" "),v("p",[t._v("​\t\trotate 1\n}")])]),t._v(" "),v("li",[v("p",[t._v("参数说明")])])]),t._v(" "),v("p",[t._v("daily  日志的轮替周期是每天")]),t._v(" "),v("p",[t._v("weekly  日志的轮替周期是每周")]),t._v(" "),v("p",[t._v("monthly  日志的轮替周期是每月")]),t._v(" "),v("p",[t._v("rotate  数字保留的日志文件的个数。0指没有备份")]),t._v(" "),v("p",[t._v("compress  日志轮替时，旧的日志进行压缩")]),t._v(" "),v("p",[t._v("create mode owner group  建立新日志，同时指定新日志的权限与所有者和所属组")]),t._v(" "),v("p",[t._v("mail address  当日志轮替时，输出内容通过邮件发送到指定的邮件地址。")]),t._v(" "),v("p",[t._v("missingok  如果日志不存在，则忽略该日志的警告信息")]),t._v(" "),v("p",[t._v("notifempty  如果日志为空文件，则不进行日志轮替")]),t._v(" "),v("p",[t._v("minsize  大小  日志轮替的最小值。也就是日志一定要达到这个最小值才会轮替，否则就算时间达到也不轮替")]),t._v(" "),v("p",[t._v("size  大小  日志只有大于指定大小才进行日志轮替，而不是按照时间轮替")]),t._v(" "),v("p",[t._v("dateext  使用日期作为日志轮替文件的后缀")]),t._v(" "),v("p",[t._v("sharedscripts  在此关键字之后的脚本只执行一次")]),t._v(" "),v("p",[t._v("prerotate/endscript  在日志轮替之前执行脚本命令")]),t._v(" "),v("p",[t._v("postrotate/endscript  在日志轮替之后执行脚本命令")]),t._v(" "),v("h3",{attrs:{id:"把自己的日志加入日志轮替"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#把自己的日志加入日志轮替"}},[t._v("#")]),t._v(" 把自己的日志加入日志轮替")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("第一种方法是直接在/etc/logrotate.conf配置文件中写入该日志的轮替策略")])]),t._v(" "),v("li",[v("p",[t._v("第二种方法是在/etc/logrotate.d/目录中新建立该日志的轮替文件，在该轮替文件中写入正确的轮替策略，因为该目录中的文件都会被“include”到主配置文件中，所以也可以把日志加入轮替。")])]),t._v(" "),v("li",[v("p",[t._v("推荐使用第二种方法，因为系统中需要轮替的日志非常多，如果全都直接写入/etc/logrotate.conf配置文件，那么这个文件的可管理性就会非常差，不利于此文件的维护。")])]),t._v(" "),v("li",[v("p",[t._v("在/etc/logrotate.d/配置轮替文件一览")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting@master/studynotes/Linux/images/18/07.png",alt:"05"}})])])]),t._v(" "),v("h3",{attrs:{id:"应用实例"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#应用实例"}},[t._v("#")]),t._v(" 应用实例")]),t._v(" "),v("p",[t._v("看一个案例，在/etc/logrotate.conf进行配置,或者直接在letc/logrotate.d下创建文件 frxlog 编写如下内容，具体轮替的效果可以参考/var/log下的boot.log情况.")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting@master/studynotes/Linux/images/18/08.png",alt:"05"}})]),t._v(" "),v("p",[t._v("轮替的效果:")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting@master/studynotes/Linux/images/18/09.png",alt:"05"}})]),t._v(" "),v("h2",{attrs:{id:"日志轮替机制原理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#日志轮替机制原理"}},[t._v("#")]),t._v(" 日志轮替机制原理")]),t._v(" "),v("p",[t._v("日志轮替之所以可以在指定的时间备份日志，是依赖系统定时任务。在/etc/cron.daily/目录，就会发现这个目录中是有logrotate 文件(可执行)，logrotate 通过这个文件依赖定时任务执行的。")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting@master/studynotes/Linux/images/18/10.png",alt:"05"}})]),t._v(" "),v("p",[v("img",{attrs:{src:"https://jsdelivr.codeqihan.com//gh/xustudyxu/image-hosting@master/studynotes/Linux/images/18/11.png",alt:"05"}})]),t._v(" "),v("h2",{attrs:{id:"查看内存日志"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#查看内存日志"}},[t._v("#")]),t._v(" 查看内存日志")]),t._v(" "),v("p",[v("font",{attrs:{color:"#DC4040",size:"4",face:"黑体"}},[t._v("journalctl ")]),t._v("                                                         可以查看内存日志,这里我们看看常用的指令")],1),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("命令")]),t._v(" "),v("th",[t._v("说明")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("journalctl")]),t._v(" "),v("td",[t._v("查看全部")])]),t._v(" "),v("tr",[v("td",[t._v("journalctl  -n 3")]),t._v(" "),v("td",[t._v("查看最新3条")])]),t._v(" "),v("tr",[v("td",[t._v("journalctl  --since 19:00  --until 19:10:10")]),t._v(" "),v("td",[t._v("查看起始时间到结束时间的日志可加日期")])]),t._v(" "),v("tr",[v("td",[t._v("journalctl -p err")]),t._v(" "),v("td",[t._v("报错日志")])]),t._v(" "),v("tr",[v("td",[t._v("journalctl -o verbose")]),t._v(" "),v("td",[t._v("日志详细内容")])]),t._v(" "),v("tr",[v("td",[t._v("journalctl_PID=1245  _COMM=sshd")]),t._v(" "),v("td",[t._v("查看包含这些参数的日志（在详细日志查看)或者 journalctl | grep sshd")])])])]),t._v(" "),v("p",[t._v("注意:"),v("strong",[t._v("journalctl  查看的是内存日志，重启清空")])]),t._v(" "),v("blockquote",[v("p",[t._v("案例:使用journalctl | grep sshd来看看用户登录清空,重启系统，再次查询，看看日志有什么变化没有")]),t._v(" "),v("p",[t._v("重启之后。发现日志清空")])])])}),[],!1,null,null,null);v.default=r.exports}}]);